module.exports=[44066,a=>{"use strict";async function b(a,c,d={}){let e=function(a){if(!a)return null;try{let b=new URL(a).pathname.split("/").filter(Boolean),c=b.findIndex(a=>"public"===a);if(-1===c)return null;let d=decodeURIComponent(b[c+1]??""),e=b.slice(c+2).map(a=>decodeURIComponent(a)).join("/");if(!d||!e)return null;return{bucket:d,path:e}}catch(a){return console.error("공개 스토리지 URL 파싱 실패",a),null}}(c);if(!e)return;let f=d.expectedBucket??"content-images";if(f&&e.bucket!==f)return;let{error:g}=await a.storage.from(e.bucket).remove([e.path]);g&&console.error("스토리지 객체 삭제 실패",g)}a.s(["removePublicStorageFile",()=>b])},93695,(a,b,c)=>{b.exports=a.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},62212,a=>{a.n(a.i(66114))},65893,a=>{a.n(a.i(68852))},29171,a=>{"use strict";a.s(["Card",()=>d,"CardContent",()=>h,"CardDescription",()=>g,"CardFooter",()=>i,"CardHeader",()=>e,"CardTitle",()=>f]);var b=a.i(7997),c=a.i(82248);function d({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card",className:(0,c.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",a),...d})}function e({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-header",className:(0,c.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",a),...d})}function f({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-title",className:(0,c.cn)("leading-none font-semibold",a),...d})}function g({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-description",className:(0,c.cn)("text-muted-foreground text-sm",a),...d})}function h({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-content",className:(0,c.cn)("px-6",a),...d})}function i({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-footer",className:(0,c.cn)("flex items-center px-6 [.border-t]:pt-6",a),...d})}},13047,a=>{a.n(a.i(67304))},4404,a=>{a.n(a.i(13348))},55046,a=>{"use strict";a.s(["devotionCreateSchema",()=>c,"devotionUpdateSchema",()=>d]);var b=a.i(83111);let c=b.z.object({title:b.z.string().min(3,"제목은 최소 3자 이상 입력해주세요."),scriptureRef:b.z.string().min(2,"성경 구절을 입력해주세요."),scriptureText:b.z.string().min(5,"구절 내용을 입력해주세요."),body:b.z.string().min(50,"묵상 내용은 최소 50자 이상 작성해주세요."),imageUrl:b.z.string().url("올바른 이미지 주소가 아닙니다.").optional().or(b.z.literal("").transform(()=>void 0))}),d=c.extend({id:b.z.string().uuid()})},42642,a=>{"use strict";a.s(["deleteDevotionAction",()=>l,"updateDevotionAction",()=>m]);var b=a.i(37936),c=a.i(18558);a.i(70396);var d=a.i(73727),e=a.i(98310),f=a.i(51860),g=a.i(53058),h=a.i(63250),i=a.i(55046),j=a.i(44066),k=a.i(11388);async function l(a){let b=a.get("devotionId");if(!b||"string"!=typeof b)throw Error("잘못된 요청입니다.");let f=await (0,g.getCurrentProfile)();f||(0,d.redirect)("/login?redirectTo=/devotion");let i=await (0,e.createSupabaseServerClient)(),{data:l,error:m}=await i.from("devotions").select("id, author_id, image_url").eq("id",b).maybeSingle();if(m)throw(0,k.logError)("묵상 조회 실패",{error:m,devotionId:b}),Error("삭제할 묵상을 찾지 못했습니다.");if(!l)throw Error("이미 삭제되었거나 존재하지 않는 묵상입니다.");if(l.author_id!==f.id&&!(0,h.isAdmin)(f.role))throw Error("삭제 권한이 없습니다.");let{error:n}=await i.from("devotions").delete().eq("id",b);if(n)throw(0,k.logError)("묵상 삭제 실패",{error:n,devotionId:b}),Error("묵상을 삭제하지 못했습니다. 잠시 후 다시 시도해주세요.");l.image_url&&await (0,j.removePublicStorageFile)(i,l.image_url),(0,c.revalidatePath)("/devotion"),(0,d.redirect)("/devotion")}async function m(a){let b=await (0,g.getCurrentProfile)();b||(0,d.redirect)("/login");let l=i.devotionUpdateSchema.safeParse(a);if(!l.success)return{status:"error",message:"입력값을 확인해주세요.",fieldErrors:l.error.flatten().fieldErrors};let m=await (0,e.createSupabaseServerClient)(),{data:n,error:o}=await m.from("devotions").select("author_id, image_url").eq("id",l.data.id).maybeSingle();if(o||!n)return(0,k.logError)("묵상 조회 실패",{error:o,devotionId:l.data.id}),{status:"error",message:"묵상을 찾지 못했습니다."};if(n.author_id!==b.id&&!(0,h.isAdmin)(b.role))return{status:"error",message:"수정 권한이 없습니다."};let p=l.data.imageUrl?l.data.imageUrl.trim():null,{error:q}=await m.from("devotions").update({title:l.data.title.trim(),scripture_ref:l.data.scriptureRef.trim(),scripture_text:(0,f.sanitizeHTML)(l.data.scriptureText),body:(0,f.sanitizeHTML)(l.data.body),image_url:p}).eq("id",l.data.id);if(q)return(0,k.logError)("묵상 업데이트 실패",{error:q,devotionId:l.data.id}),{status:"error",message:"묵상을 수정하지 못했습니다. 잠시 후 다시 시도해주세요."};n.image_url&&n.image_url!==p&&await (0,j.removePublicStorageFile)(m,n.image_url),(0,c.revalidatePath)("/devotion"),(0,c.revalidatePath)(`/devotion/${l.data.id}`),(0,d.redirect)(`/devotion/${l.data.id}`)}(0,a.i(13095).ensureServerEntryExports)([l,m]),(0,b.registerServerReference)(l,"406365968578a9e391e6fd30dfa39723ca2cbf9405",null),(0,b.registerServerReference)(m,"4060930bc37c927ba46773326a9cf52a31cf762c4e",null)},73200,a=>{a.n(a.i(4202))},42263,a=>{"use strict";a.s(["006e87d2ba50d7749061e0234a2c5ee819ab969621",()=>d.signOutAction,"4060930bc37c927ba46773326a9cf52a31cf762c4e",()=>e.updateDevotionAction,"406365968578a9e391e6fd30dfa39723ca2cbf9405",()=>e.deleteDevotionAction],42263),a.s([],2844);var b=a.i(42998),c=a.i(42642);a.i(2844);var d=b,e=c},78766,a=>{"use strict";a.s(["default",()=>q,"generateMetadata",()=>p]);var b=a.i(7997);a.i(70396);var c=a.i(73727),d=a.i(97647),e=a.i(3236),f=a.i(43917),g=a.i(29171),h=a.i(20407),i=a.i(42642),j=a.i(77049),k=a.i(78137),l=a.i(53058),m=a.i(63250),n=a.i(55747),o=a.i(44839);async function p({params:a}){let b=await (0,k.getDevotionById)(a.id);if(!b)return{title:"묵상 상세 | 위루다 선교 공동체",description:"선교지 묵상을 확인해보세요."};let c=(0,o.stripHtml)(b.body)||b.scriptureText||`${b.scriptureRef} 묵상 나눔입니다.`,d=(0,o.truncateText)(c.replace(/\s+/g," ").trim(),160),e=`${b.title} | 묵상 나눔`,f=b.imageUrl?[{url:b.imageUrl,width:1200,height:630,alt:b.title}]:void 0;return{title:e,description:d,openGraph:{title:e,description:d,type:"article",url:`/devotion/${b.id}`,images:f},twitter:{card:f?"summary_large_image":"summary",title:e,description:d,images:f?.map(a=>a.url)}}}async function q({params:a}){let o=await (0,j.detectInitialLanguage)(),p=await (0,l.getCurrentProfile)(),q=await (0,k.getDevotionById)(a.id);q||(0,c.notFound)(),await (0,k.incrementDevotionViewCount)(q.id);let r=p&&(p.id===q.authorId||(0,m.isAdmin)(p.role));return(0,b.jsxs)("div",{className:"space-y-8",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,b.jsxs)("span",{children:["작성일 ",(0,n.formatDate)(q.publishedAt,o)]}),(0,b.jsxs)("span",{children:["조회수 ",q.views]})]}),(0,b.jsx)("h1",{className:"text-3xl font-semibold leading-snug text-slate-900",children:q.title}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-3 text-sm text-muted-foreground",children:[(0,b.jsxs)("span",{children:["작성자: ",q.authorName]}),(0,b.jsxs)("span",{children:["역할: ",(0,m.getUserRoleLabel)(q.authorRole)]}),p?.id===q.authorId&&(0,b.jsx)("span",{children:"내 글"})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(f.Button,{asChild:!0,variant:"outline",children:(0,b.jsx)(d.default,{href:"/devotion",children:"목록으로"})}),r&&(0,b.jsxs)("form",{action:i.deleteDevotionAction,children:[(0,b.jsx)("input",{type:"hidden",name:"devotionId",value:q.id}),(0,b.jsx)(f.Button,{type:"submit",variant:"destructive",children:"삭제"})]}),r&&(0,b.jsx)(f.Button,{asChild:!0,variant:"secondary",children:(0,b.jsx)(d.default,{href:`/devotion/${q.id}/edit`,children:"수정"})})]})]}),q.imageUrl&&(0,b.jsx)("div",{className:"relative h-64 w-full overflow-hidden rounded-3xl border border-border/60",children:(0,b.jsx)(e.default,{src:q.imageUrl,alt:"묵상 대표 이미지",fill:!0,className:"object-cover",sizes:"(min-width: 1024px) 60vw, 100vw"})}),(0,b.jsxs)(g.Card,{className:"border border-border/60",children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsx)(g.CardTitle,{className:"text-lg text-primary",children:q.scriptureRef})}),(0,b.jsx)(g.CardContent,{children:(0,b.jsx)("blockquote",{className:"rounded-xl bg-muted/40 p-6 text-base leading-relaxed text-slate-800",children:q.scriptureText})})]}),(0,b.jsx)("article",{className:"prose prose-slate max-w-none rounded-3xl border border-border/60 bg-white p-8 text-slate-900",children:(0,b.jsx)("div",{dangerouslySetInnerHTML:{__html:q.body}})}),(0,b.jsx)(h.Separator,{}),(0,b.jsxs)(g.Card,{className:"border border-border/50 bg-muted/10",children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsx)(g.CardTitle,{className:"text-base text-muted-foreground",children:"작성자 정보"})}),(0,b.jsxs)(g.CardContent,{className:"flex flex-wrap gap-6 text-sm text-muted-foreground",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-slate-800",children:q.authorName}),(0,b.jsx)("p",{children:(0,m.getProfileStatusLabel)(q.authorStatus)})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{children:["역할: ",(0,m.getUserRoleLabel)(q.authorRole)]}),!r&&(0,b.jsx)("p",{children:"함께 기도와 응원을 댓글로 남겨주세요."})]})]}),(0,b.jsx)(g.CardFooter,{children:(0,b.jsx)(f.Button,{asChild:!0,variant:"secondary",children:(0,b.jsx)(d.default,{href:"/prayer",children:"기도 제목 살펴보기"})})})]})]})}}];

//# sourceMappingURL=%5Broot-of-the-server%5D__25a78842._.js.map