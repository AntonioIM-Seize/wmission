module.exports=[37936,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"registerServerReference",{enumerable:!0,get:function(){return d.registerServerReference}});let d=a.r(11857)},13095,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},44066,a=>{"use strict";async function b(a,c,d={}){let e=function(a){if(!a)return null;try{let b=new URL(a).pathname.split("/").filter(Boolean),c=b.findIndex(a=>"public"===a);if(-1===c)return null;let d=decodeURIComponent(b[c+1]??""),e=b.slice(c+2).map(a=>decodeURIComponent(a)).join("/");if(!d||!e)return null;return{bucket:d,path:e}}catch(a){return console.error("공개 스토리지 URL 파싱 실패",a),null}}(c);if(!e)return;let f=d.expectedBucket??"content-images";if(f&&e.bucket!==f)return;let{error:g}=await a.storage.from(e.bucket).remove([e.path]);g&&console.error("스토리지 객체 삭제 실패",g)}a.s(["removePublicStorageFile",()=>b])},93695,(a,b,c)=>{b.exports=a.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},62212,a=>{a.n(a.i(66114))},43710,a=>{a.n(a.i(13954))},29171,a=>{"use strict";a.s(["Card",()=>d,"CardContent",()=>h,"CardDescription",()=>g,"CardFooter",()=>i,"CardHeader",()=>e,"CardTitle",()=>f]);var b=a.i(7997),c=a.i(82248);function d({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card",className:(0,c.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",a),...d})}function e({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-header",className:(0,c.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",a),...d})}function f({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-title",className:(0,c.cn)("leading-none font-semibold",a),...d})}function g({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-description",className:(0,c.cn)("text-muted-foreground text-sm",a),...d})}function h({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-content",className:(0,c.cn)("px-6",a),...d})}function i({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-footer",className:(0,c.cn)("flex items-center px-6 [.border-t]:pt-6",a),...d})}},58903,a=>{"use strict";a.s(["Separator",()=>b]);let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call Separator() from the server but Separator is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/components/ui/separator.tsx <module evaluation>","Separator")},19665,a=>{"use strict";a.s(["Separator",()=>b]);let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call Separator() from the server but Separator is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/components/ui/separator.tsx","Separator")},20407,a=>{"use strict";a.i(58903);var b=a.i(19665);a.n(b)},55747,a=>{"use strict";a.s(["formatDate",()=>c]);var b=a.i(14617);function c(a,d=b.DEFAULT_LANGUAGE){if(!a)return"";let e=a instanceof Date?a:new Date(a);return Number.isNaN(e.getTime())?"":new Intl.DateTimeFormat(d,{year:"numeric",month:"short",day:"numeric"}).format(e)}},80455,(a,b,c)=>{b.exports=a.x("jsdom",()=>require("jsdom"))},86703,a=>{"use strict";function b(a){return a.replace(/[%_]/g,a=>`\\${a}`)}a.s(["escapeIlikePattern",()=>b])},44839,a=>{"use strict";function b(a,b){return a?a.length<=b?a:`${a.slice(0,b).trimEnd()}…`:""}function c(a){return a?a.replace(/[#*_>`~\[\]\(\)]/g,""):""}function d(a){return a?a.replace(/<[^>]*>/g,""):""}a.s(["stripHtml",()=>d,"stripMarkdown",()=>c,"truncateText",()=>b])},22605,a=>{"use strict";a.s(["Input",()=>d]);var b=a.i(7997),c=a.i(82248);function d({className:a,type:d,...e}){return(0,b.jsx)("input",{type:d,"data-slot":"input",className:(0,c.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",a),...e})}},58394,a=>{"use strict";a.s(["getPrayerAdminMetrics",()=>i,"getPrayerById",()=>h,"getPrayers",()=>g]);var b=a.i(98310),c=a.i(51860),d=a.i(86703),e=a.i(44839),f=a.i(11388);async function g(a){let{page:c,pageSize:g,filters:h}=a,i=await (0,b.createSupabaseServerClient)(),j=(c-1)*g,k=h?.search?.trim(),l=h?.status??"all",m=i.from("prayers").select(`
        id,
        content,
        created_at,
        is_answered,
        answered_at,
        author:profiles!prayers_author_id_fkey (
          id,
          full_name,
          status,
          role
        ),
        prayer_reactions (
          reaction_type
        ),
        image_url
      `,{count:"exact"}).order("created_at",{ascending:!1});if("answered"===l?m=m.eq("is_answered",!0):"pending"===l&&(m=m.eq("is_answered",!1)),k){let a=`%${(0,d.escapeIlikePattern)(k)}%`;m=m.or(`content.ilike.${a},profiles!prayers_author_id_fkey.full_name.ilike.${a}`)}let{data:n,count:o,error:p}=await m.range(j,j+g-1);if(p)return(0,f.logError)("기도 목록 조회 실패",{error:p,pagination:{page:c,pageSize:g},filters:h}),{items:[],total:0,page:c,pageSize:g};let q=n?.map(a=>{let b=a.content??"",c=(a.prayer_reactions??[]).reduce((a,b)=>(b?.reaction_type==="amen"&&(a.amen+=1),b?.reaction_type==="together"&&(a.together+=1),a),{amen:0,together:0});return{id:a.id,content:(0,e.truncateText)((0,e.stripMarkdown)(b),180),createdAt:a.created_at,isAnswered:a.is_answered,answeredAt:a.answered_at,authorName:a.author?.full_name??"익명",reactions:c,imageUrl:a.image_url??null}})??[];return{items:q,total:o??q.length,page:c,pageSize:g}}async function h(a){let d=await (0,b.createSupabaseServerClient)(),{data:e,error:g}=await d.from("prayers").select(`
        id,
        content,
        created_at,
        is_answered,
        answered_at,
        author:profiles!prayers_author_id_fkey (
          id,
          full_name,
          status,
          role
        ),
        prayer_reactions (
          reaction_type
        ),
        image_url
      `).eq("id",a).maybeSingle();if(g)return(0,f.logError)("기도 상세 조회 실패",{error:g,prayerId:a}),null;if(!e)return null;let h=(e.prayer_reactions??[]).reduce((a,b)=>(b?.reaction_type==="amen"&&(a.amen+=1),b?.reaction_type==="together"&&(a.together+=1),a),{amen:0,together:0});return{id:e.id,content:(0,c.sanitizeHTML)(e.content??""),createdAt:e.created_at,isAnswered:e.is_answered,answeredAt:e.answered_at,authorId:e.author?.id??"",authorName:e.author?.full_name??"익명",authorRole:e.author?.role??"member",authorStatus:e.author?.status??"approved",reactions:h,imageUrl:e.image_url??null}}async function i(){let a=await (0,b.createSupabaseServerClient)(),[c,d]=await Promise.all([a.from("prayers").select("id",{count:"exact",head:!0}),a.from("prayers").select("id",{count:"exact",head:!0}).eq("is_answered",!0)]);c.error&&(0,f.logError)("전체 기도 수 조회 실패",{error:c.error}),d.error&&(0,f.logError)("응답 기도 수 조회 실패",{error:d.error});let e=c.count??0,g=d.count??0,h=Math.max(e-g,0);return{total:e,answered:g,pending:h}}},90982,a=>{"use strict";a.s(["deletePrayerAdminAction",()=>h,"togglePrayerAnsweredAction",()=>i]);var b=a.i(37936),c=a.i(18558),d=a.i(53058),e=a.i(98310),f=a.i(11388),g=a.i(44066);async function h(a){await (0,d.requireRole)("admin");let b=a.get("prayerId");if("string"!=typeof b)throw Error("잘못된 요청입니다.");let h=await (0,e.createSupabaseServerClient)(),{data:i,error:j}=await h.from("prayers").select("id,image_url").match({id:b}).maybeSingle();j&&(0,f.logError)("관리자 기도 삭제 전 조회 실패",{error:j,prayerId:b});let{error:k}=await h.from("prayers").delete().match({id:b});if(k)throw(0,f.logError)("관리자 기도 삭제 실패",{error:k,prayerId:b}),Error("기도 제목을 삭제하지 못했습니다.");let l=i?.image_url??null;l&&await (0,g.removePublicStorageFile)(h,l),(0,c.revalidatePath)("/admin/prayers"),(0,c.revalidatePath)(`/admin/prayers/${b}`)}async function i(a){await (0,d.requireRole)("admin");let b=a.get("prayerId"),g=a.get("answered");if("string"!=typeof b||"string"!=typeof g)throw Error("잘못된 요청입니다.");let h="true"===g,i=await (0,e.createSupabaseServerClient)(),j={is_answered:h,answered_at:h?new Date().toISOString():null},{error:k}=await i.from("prayers").update(j).match({id:b});if(k)throw(0,f.logError)("기도 응답 상태 갱신 실패",{error:k,prayerId:b,nextState:h}),Error("응답 상태를 변경하지 못했습니다.");(0,c.revalidatePath)("/admin/prayers"),(0,c.revalidatePath)(`/admin/prayers/${b}`)}(0,a.i(13095).ensureServerEntryExports)([h,i]),(0,b.registerServerReference)(h,"4006106475146b4cc05ec5299af620d4ce2362964d",null),(0,b.registerServerReference)(i,"400e4fa9a13f9ba5eb0bec3b4cdafc709a29e617e9",null)},59772,a=>{"use strict";a.s(["4006106475146b4cc05ec5299af620d4ce2362964d",()=>c.deletePrayerAdminAction,"400e4fa9a13f9ba5eb0bec3b4cdafc709a29e617e9",()=>c.togglePrayerAnsweredAction],59772),a.s([],58807);var b=a.i(90982);a.i(58807);var c=b},38837,a=>{"use strict";a.s(["default",()=>l]);var b=a.i(7997),c=a.i(97647),d=a.i(43917),e=a.i(29171),f=a.i(22605),g=a.i(20407),h=a.i(77049),i=a.i(58394),j=a.i(55747),k=a.i(90982);async function l({searchParams:a}){let e=await (0,h.detectInitialLanguage)(),l=Math.max(Number(a.page??"1")||1,1),o=a.q?.trim()??"",p=a.status??"all",[q,{items:r,total:s}]=await Promise.all([(0,i.getPrayerAdminMetrics)(),(0,i.getPrayers)({page:l,pageSize:15,filters:{search:o,status:p}})]),t=Math.max(Math.ceil(s/15),1);return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-xl font-semibold text-slate-900",children:"기도 관리"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"기도 제목을 모니터링하고 필요 시 삭제하거나 응답 상태를 변경합니다."})]}),(0,b.jsx)(d.Button,{asChild:!0,variant:"outline",children:(0,b.jsx)(c.default,{href:"/prayer",children:"공개 페이지 보기"})})]}),(0,b.jsx)(g.Separator,{}),(0,b.jsx)("section",{children:(0,b.jsxs)("div",{className:"grid gap-3 md:grid-cols-3",children:[(0,b.jsx)(m,{title:"전체 기도",value:q.total.toLocaleString(e),description:"등록된 전체 기도 수"}),(0,b.jsx)(m,{title:"응답 완료",value:q.answered.toLocaleString(e),description:"응답 처리된 기도 수"}),(0,b.jsx)(m,{title:"응답 대기",value:q.pending.toLocaleString(e),description:"응답 미처리 기도 수"})]})}),(0,b.jsx)("section",{className:"rounded-xl border border-border/60 bg-white p-4 shadow-sm",children:(0,b.jsxs)("form",{className:"flex flex-col gap-3 md:flex-row md:items-end md:gap-4",action:"/admin/prayers",children:[(0,b.jsxs)("div",{className:"flex flex-1 flex-col gap-1",children:[(0,b.jsx)("label",{className:"text-xs font-medium text-muted-foreground",htmlFor:"q",children:"검색어"}),(0,b.jsx)(f.Input,{id:"q",name:"q",placeholder:"기도 내용 또는 작성자 이름을 입력하세요.",defaultValue:o})]}),(0,b.jsxs)("div",{className:"flex w-full flex-col gap-1 md:w-48",children:[(0,b.jsx)("label",{className:"text-xs font-medium text-muted-foreground",htmlFor:"status",children:"상태"}),(0,b.jsxs)("select",{id:"status",name:"status",defaultValue:p,className:"h-9 rounded-md border border-input bg-transparent px-3 text-sm shadow-xs outline-none transition focus-visible:border-ring focus-visible:ring-[3px] focus-visible:ring-ring/50",children:[(0,b.jsx)("option",{value:"all",children:"전체"}),(0,b.jsx)("option",{value:"pending",children:"응답 대기"}),(0,b.jsx)("option",{value:"answered",children:"응답 완료"})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(d.Button,{type:"submit",children:"필터 적용"}),(0,b.jsx)(d.Button,{variant:"ghost",asChild:!0,children:(0,b.jsx)(c.default,{href:"/admin/prayers",children:"초기화"})})]})]})}),(0,b.jsxs)("div",{className:"space-y-4",children:[0===r.length&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"등록된 기도 제목이 없습니다."}),r.map(a=>(0,b.jsx)("div",{className:"rounded-xl border border-border/60 bg-white p-4 shadow-sm",children:(0,b.jsxs)("div",{className:"flex flex-col justify-between gap-4 md:flex-row",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:[(0,b.jsx)("span",{children:(0,j.formatDate)(a.createdAt,e)}),a.isAnswered&&(0,b.jsx)("span",{className:"rounded-full border border-emerald-400 px-2 py-0.5 text-emerald-600",children:"응답됨"}),!a.isAnswered&&(0,b.jsx)("span",{className:"rounded-full border border-amber-400 px-2 py-0.5 text-amber-600",children:"진행 중"}),a.imageUrl&&(0,b.jsx)("span",{className:"rounded-full border border-sky-300 px-2 py-0.5 text-sky-600",children:"이미지 포함"})]}),(0,b.jsx)("p",{className:"text-base text-slate-900",children:a.content}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-3 text-xs text-muted-foreground",children:[(0,b.jsxs)("span",{children:["작성자: ",a.authorName]}),(0,b.jsxs)("span",{children:["아멘: ",a.reactions.amen.toLocaleString(e)]}),(0,b.jsxs)("span",{children:["함께 기도합니다: ",a.reactions.together.toLocaleString(e)]})]})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-2 self-stretch md:w-56",children:[(0,b.jsxs)("div",{className:"flex gap-2 self-end",children:[(0,b.jsx)(d.Button,{asChild:!0,variant:"outline",size:"sm",children:(0,b.jsx)(c.default,{href:`/prayer/${a.id}`,target:"_blank",rel:"noreferrer",children:"공개 보기"})}),(0,b.jsx)(d.Button,{asChild:!0,variant:"secondary",size:"sm",children:(0,b.jsx)(c.default,{href:`/admin/prayers/${a.id}`,children:"상세 관리"})})]}),(0,b.jsxs)("div",{className:"flex gap-2 self-end",children:[(0,b.jsxs)("form",{action:k.togglePrayerAnsweredAction,className:"inline-flex",children:[(0,b.jsx)("input",{type:"hidden",name:"prayerId",value:a.id}),(0,b.jsx)("input",{type:"hidden",name:"answered",value:a.isAnswered?"false":"true"}),(0,b.jsx)(d.Button,{type:"submit",size:"sm",variant:a.isAnswered?"outline":"default",children:a.isAnswered?"응답 해제":"응답 처리"})]}),(0,b.jsxs)("form",{action:k.deletePrayerAdminAction,className:"inline-flex",children:[(0,b.jsx)("input",{type:"hidden",name:"prayerId",value:a.id}),(0,b.jsx)(d.Button,{type:"submit",size:"sm",variant:"destructive",children:"삭제"})]})]})]})]})},a.id))]}),(0,b.jsx)(n,{page:l,totalPages:t,searchKeyword:o,statusFilter:p})]})}function m({title:a,value:c,description:d}){return(0,b.jsxs)(e.Card,{className:"bg-white",children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{className:"text-sm font-semibold text-muted-foreground",children:a}),(0,b.jsx)(e.CardDescription,{children:d})]}),(0,b.jsx)(e.CardContent,{children:(0,b.jsx)("p",{className:"text-2xl font-bold text-slate-900",children:c})})]})}function n({page:a,totalPages:e,searchKeyword:f,statusFilter:g}){if(e<=1)return null;let h=new URLSearchParams;f&&h.set("q",f),g&&"all"!==g&&h.set("status",g);let i=a=>{let b=new URLSearchParams(h);a>1&&b.set("page",String(a));let c=b.toString();return c?`/admin/prayers?${c}`:"/admin/prayers"};return(0,b.jsxs)("div",{className:"flex items-center justify-between rounded-xl border border-border/60 bg-white p-4 text-sm",children:[(0,b.jsx)(d.Button,{asChild:!0,variant:"ghost",disabled:a<=1,children:(0,b.jsx)(c.default,{href:i(a-1),children:"이전"})}),(0,b.jsxs)("span",{className:"text-muted-foreground",children:[a," / ",e]}),(0,b.jsx)(d.Button,{asChild:!0,variant:"ghost",disabled:a>=e,children:(0,b.jsx)(c.default,{href:i(a+1),children:"다음"})})]})}},16407,a=>{a.v(a=>Promise.resolve().then(()=>a(89431)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__dee359c2._.js.map