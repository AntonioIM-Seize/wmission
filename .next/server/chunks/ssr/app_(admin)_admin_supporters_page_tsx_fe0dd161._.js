module.exports=[86404,a=>{"use strict";a.s(["default",()=>p],86404);var b=a.i(7997),c=a.i(97647),d=a.i(40088),e=a.i(43917),f=a.i(22605),g=a.i(20407),h=a.i(82248);function i({className:a,...c}){return(0,b.jsx)("textarea",{"data-slot":"textarea",className:(0,h.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),...c})}var j=a.i(98310),k=a.i(86703);async function l(a){let b=(await (0,j.createSupabaseServerClient)()).from("supporters").select("*").order("supported_on",{ascending:!1}).order("created_at",{ascending:!1}),c=a?.search?.trim();if(c){let a=`%${(0,k.escapeIlikePattern)(c)}%`;b=b.or(`name.ilike.${a},memo.ilike.${a}`)}a?.startDate&&(b=b.gte("supported_on",a.startDate)),a?.endDate&&(b=b.lte("supported_on",a.endDate)),"number"!=typeof a?.minAmount||Number.isNaN(a.minAmount)||(b=b.gte("amount",a.minAmount)),"number"!=typeof a?.maxAmount||Number.isNaN(a.maxAmount)||(b=b.lte("amount",a.maxAmount));let{data:d,error:e}=await b;return e?(console.error("후원자 목록 조회 실패",e),[]):d?.map(a=>({id:a.id,name:a.name,amount:Number(a.amount),supportedOn:a.supported_on,memo:a.memo,createdAt:a.created_at,updatedAt:a.updated_at}))??[]}var m=a.i(55747),n=a.i(83122),o=a.i(71859);async function p({searchParams:a}){var d;let f=a.q?.trim()??"",h=z(a.startDate)?a.startDate:"",i=z(a.endDate)?a.endDate:"",j=A(a.minAmount),k=A(a.maxAmount),m=!!(h&&i&&h>i),n=m?[]:await l({search:f,startDate:h||null,endDate:i||null,minAmount:j,maxAmount:k}),p=n.reduce((a,b)=>a+b.amount,0),v=n.length?p/n.length:0,B=n[0]?.supportedOn??null,C=function(a){if(!a.length)return{count:0,amount:0};let b=new Date(new Date);return b.setDate(b.getDate()-30),a.reduce((a,c)=>{let d=new Date(c.supportedOn);return!Number.isNaN(d.getTime())&&d>=b&&(a.count+=1,a.amount+=c.amount),a},{count:0,amount:0})}(n),D=(d=n).length?d.reduce((a,b)=>!a||b.amount>a.amount?{name:b.name,amount:b.amount,supportedOn:b.supportedOn,memo:b.memo??null}:a,null):null,E=function(a){let b=new Map;return a.forEach(a=>{let c=new Date(a.supportedOn);if(Number.isNaN(c.getTime()))return;let d=`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}`,e=b.get(d)??{count:0,amount:0};e.count+=1,e.amount+=a.amount,b.set(d,e)}),Array.from(b.entries()).map(([a,b])=>{let[c,d]=a.split("-");return{monthKey:a,label:`${c}년 ${d}월`,count:b.count,amount:b.amount}}).sort((a,b)=>a.monthKey<b.monthKey?1:-1).slice(0,6)}(n),F=function(a){let b=[];return a.search&&b.push(`검색: ${a.search}`),a.startDate&&b.push(`시작일: ${a.startDate}`),a.endDate&&b.push(`종료일: ${a.endDate}`),"number"==typeof a.minAmount&&b.push(`최소 금액: ${q(a.minAmount)}`),"number"==typeof a.maxAmount&&b.push(`최대 금액: ${q(a.maxAmount)}`),b}({search:f,startDate:h,endDate:i,minAmount:j,maxAmount:k}),G=m?null:function(a){let b=new URLSearchParams;a.search&&b.set("q",a.search),a.startDate&&b.set("startDate",a.startDate),a.endDate&&b.set("endDate",a.endDate),"number"==typeof a.minAmount&&b.set("minAmount",String(a.minAmount)),"number"==typeof a.maxAmount&&b.set("maxAmount",String(a.maxAmount));let c=b.toString();return c?`/admin/supporters/export?${c}`:"/admin/supporters/export"}({search:f,startDate:h,endDate:i,minAmount:j,maxAmount:k});return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-xl font-semibold text-slate-900",children:"후원자 관리"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"후원자 정보를 등록·수정하고 후원 금액을 집계합니다."})]}),(0,b.jsx)(e.Button,{asChild:!0,variant:"outline",size:"sm",children:(0,b.jsx)(c.default,{href:"/support",target:"_blank",children:"공개 후원 안내 보기"})})]}),(0,b.jsxs)("section",{className:"grid gap-4 md:grid-cols-4",children:[(0,b.jsx)(r,{label:"총 후원자",value:`${n.length}명`,description:"검색 조건에 해당"}),(0,b.jsx)(r,{label:"총 후원 금액",value:`${q(p)}원`,description:"검색된 데이터 기준"}),(0,b.jsx)(r,{label:"평균 후원 금액",value:n.length?`${q(v)}원`:"-",description:"필터된 데이터 기준"}),(0,b.jsx)(r,{label:"최근 30일 누적",value:C.count?`${q(C.amount)}원`:"-",description:C.count?`${C.count}건 등록`:"최근 30일 데이터 없음"})]}),(0,b.jsx)(g.Separator,{}),(0,b.jsx)(s,{defaults:{search:f,startDate:h,endDate:i,minAmount:a.minAmount??"",maxAmount:a.maxAmount??""},exportHref:G,disableExport:m}),m&&(0,b.jsxs)(o.Alert,{variant:"destructive",children:[(0,b.jsx)(o.AlertTitle,{children:"날짜 범위 오류"}),(0,b.jsx)(o.AlertDescription,{children:"시작일이 종료일보다 늦습니다. 날짜 범위를 다시 선택해주세요."})]}),F.length>0&&(0,b.jsx)(w,{filters:F,latestSupportedOn:B}),(0,b.jsx)(g.Separator,{}),D&&(0,b.jsx)(x,{supporter:D}),E.length>0&&(0,b.jsx)(y,{summary:E}),E.length>0&&(0,b.jsx)(g.Separator,{}),(0,b.jsxs)("section",{className:"grid gap-6 xl:grid-cols-[360px_1fr]",children:[(0,b.jsx)(t,{}),(0,b.jsx)(u,{supporters:n})]})]})}function q(a){return new Intl.NumberFormat("ko-KR",{maximumFractionDigits:0}).format(a)}function r({label:a,value:c,description:d}){return(0,b.jsxs)("div",{className:"rounded-xl border border-border/60 bg-white p-4 shadow-sm",children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:a}),(0,b.jsx)("p",{className:"text-2xl font-semibold text-slate-900",children:c}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:d})]})}function s({defaults:a,exportHref:d,disableExport:g}){return(0,b.jsxs)("form",{className:"space-y-3 rounded-xl border border-border/60 bg-muted/20 p-4",action:"/admin/supporters",children:[(0,b.jsxs)("div",{className:"grid gap-3 md:grid-cols-5",children:[(0,b.jsx)(f.Input,{name:"q",placeholder:"이름 또는 메모 검색",defaultValue:a.search,className:"md:col-span-2"}),(0,b.jsx)(f.Input,{name:"startDate",type:"date",defaultValue:a.startDate}),(0,b.jsx)(f.Input,{name:"endDate",type:"date",defaultValue:a.endDate}),(0,b.jsx)(f.Input,{name:"minAmount",type:"number",min:"0",step:"1000",placeholder:"최소 금액",defaultValue:a.minAmount}),(0,b.jsx)(f.Input,{name:"maxAmount",type:"number",min:"0",step:"1000",placeholder:"최대 금액",defaultValue:a.maxAmount})]}),(0,b.jsxs)("div",{className:"flex flex-wrap justify-end gap-2",children:[(0,b.jsx)(e.Button,{type:"submit",children:"필터 적용"}),(0,b.jsx)(e.Button,{asChild:!0,variant:"outline",children:(0,b.jsx)(c.default,{href:"/admin/supporters",children:"초기화"})}),d&&!g?(0,b.jsx)(e.Button,{asChild:!0,variant:"secondary",children:(0,b.jsx)("a",{href:d,children:"CSV 내보내기"})}):(0,b.jsx)(e.Button,{variant:"secondary",disabled:!0,children:"CSV 내보내기"})]})]})}function t(){return(0,b.jsxs)("div",{className:"rounded-xl border border-border/60 bg-white p-6 shadow-sm",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-slate-900",children:"후원자 추가"}),(0,b.jsx)("p",{className:"mt-1 text-xs text-muted-foreground",children:"후원자 정보를 입력하면 자동으로 목록에 반영됩니다."}),(0,b.jsxs)("form",{action:n.upsertSupporterAction,className:"mt-4 space-y-3 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs text-muted-foreground",htmlFor:"supporter-name",children:"이름"}),(0,b.jsx)(f.Input,{id:"supporter-name",name:"name",placeholder:"홍길동",required:!0,className:"mt-1"})]}),(0,b.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs text-muted-foreground",htmlFor:"supporter-amount",children:"금액 (원)"}),(0,b.jsx)(f.Input,{id:"supporter-amount",name:"amount",type:"number",min:"0",step:"1000",required:!0,className:"mt-1"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs text-muted-foreground",htmlFor:"supporter-date",children:"후원 날짜"}),(0,b.jsx)(f.Input,{id:"supporter-date",name:"supportedOn",type:"date",required:!0,className:"mt-1"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs text-muted-foreground",htmlFor:"supporter-memo",children:"메모 (선택)"}),(0,b.jsx)(i,{id:"supporter-memo",name:"memo",rows:3,className:"mt-1",placeholder:"후원 관련 메모를 남겨주세요."})]}),(0,b.jsx)(e.Button,{type:"submit",className:"w-full",children:"후원자 등록"})]})]})}function u({supporters:a}){return a.length?(0,b.jsx)("div",{className:"overflow-hidden rounded-xl border border-border/60 bg-white shadow-sm",children:(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"min-w-full divide-y divide-border/60 text-sm",children:[(0,b.jsx)("thead",{className:"bg-muted/40",children:(0,b.jsxs)("tr",{className:"text-left text-xs uppercase tracking-wide text-muted-foreground",children:[(0,b.jsx)("th",{className:"px-4 py-3",children:"이름"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"금액 (원)"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"후원 날짜"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"메모"}),(0,b.jsx)("th",{className:"px-4 py-3",children:"등록일"}),(0,b.jsx)("th",{className:"px-4 py-3 text-right",children:"관리"})]})}),(0,b.jsx)("tbody",{className:"bg-white",children:a.map(a=>(0,b.jsx)(v,{supporter:a},a.id))})]})})}):(0,b.jsx)("div",{className:"rounded-xl border border-dashed border-border/60 bg-muted/20 p-6 text-sm text-muted-foreground",children:"검색 조건에 맞는 후원자가 없습니다."})}function v({supporter:a}){let c=`supporter-${a.id}`;return(0,b.jsxs)("tr",{className:"align-top",children:[(0,b.jsx)("td",{className:"px-4 py-3",children:(0,b.jsx)(f.Input,{form:c,name:"name",defaultValue:a.name,required:!0})}),(0,b.jsx)("td",{className:"px-4 py-3",children:(0,b.jsx)(f.Input,{form:c,name:"amount",type:"number",min:"0",step:"1000",defaultValue:a.amount,required:!0})}),(0,b.jsx)("td",{className:"px-4 py-3",children:(0,b.jsx)(f.Input,{form:c,name:"supportedOn",type:"date",defaultValue:a.supportedOn,required:!0})}),(0,b.jsx)("td",{className:"px-4 py-3",children:(0,b.jsx)(i,{form:c,name:"memo",defaultValue:a.memo??"",rows:2,className:"min-h-[80px]"})}),(0,b.jsxs)("td",{className:"px-4 py-3 text-xs text-muted-foreground",children:[(0,b.jsxs)("div",{children:["후원일 ",(0,m.formatDate)(a.supportedOn)]}),(0,b.jsxs)("div",{children:["등록 ",(0,m.formatDate)(a.createdAt)]})]}),(0,b.jsx)("td",{className:"px-4 py-3",children:(0,b.jsxs)("form",{id:c,action:n.upsertSupporterAction,className:"flex flex-wrap items-center justify-end gap-2",children:[(0,b.jsx)("input",{type:"hidden",name:"id",value:a.id}),(0,b.jsx)("input",{type:"hidden",name:"supporterId",value:a.id}),(0,b.jsx)(e.Button,{type:"submit",size:"sm",children:"저장"}),(0,b.jsx)(e.Button,{type:"submit",size:"sm",variant:"destructive",formAction:n.deleteSupporterAction,children:"삭제"})]})})]})}function w({filters:a,latestSupportedOn:c}){return(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2 rounded-xl border border-border/60 bg-muted/10 p-4 text-xs text-muted-foreground",children:[(0,b.jsx)("span",{className:"font-medium text-slate-900",children:"적용된 필터"}),a.map(a=>(0,b.jsx)(d.Badge,{variant:"secondary",children:a},a)),c&&(0,b.jsxs)("span",{className:"ml-auto text-xs",children:["최신 후원일: ",(0,b.jsx)("strong",{children:(0,m.formatDate)(c)})]})]})}function x({supporter:a}){return(0,b.jsxs)("section",{className:"rounded-xl border border-amber-300/60 bg-amber-50/80 p-6 shadow-sm",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-amber-800",children:"최고 후원자 스냅샷"}),(0,b.jsxs)("p",{className:"mt-2 text-base font-semibold text-slate-900",children:[a.name," 님 · ",q(a.amount),"원"]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["후원일 ",(0,m.formatDate)(a.supportedOn)]}),a.memo&&(0,b.jsxs)("p",{className:"mt-2 text-sm text-slate-700",children:["메모: ",a.memo]})]})}function y({summary:a}){return(0,b.jsxs)("section",{className:"rounded-xl border border-border/60 bg-white p-6 shadow-sm",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-slate-900",children:"최근 6개월 월간 요약"}),(0,b.jsx)("p",{className:"mt-1 text-xs text-muted-foreground",children:"월별 후원 건수와 금액을 빠르게 확인하세요."}),(0,b.jsx)("div",{className:"mt-4 overflow-hidden rounded-lg border border-border/40",children:(0,b.jsxs)("table",{className:"min-w-full text-sm",children:[(0,b.jsx)("thead",{className:"bg-muted/40 text-xs uppercase tracking-wide text-muted-foreground",children:(0,b.jsxs)("tr",{className:"text-left",children:[(0,b.jsx)("th",{className:"px-4 py-3",children:"월"}),(0,b.jsx)("th",{className:"px-4 py-3 text-right",children:"건수"}),(0,b.jsx)("th",{className:"px-4 py-3 text-right",children:"누적 금액"})]})}),(0,b.jsx)("tbody",{children:a.map(a=>(0,b.jsxs)("tr",{className:"border-t border-border/40",children:[(0,b.jsx)("td",{className:"px-4 py-3 font-medium text-slate-900",children:a.label}),(0,b.jsxs)("td",{className:"px-4 py-3 text-right text-muted-foreground",children:[a.count.toLocaleString("ko-KR"),"건"]}),(0,b.jsxs)("td",{className:"px-4 py-3 text-right text-slate-900",children:[q(a.amount),"원"]})]},a.monthKey))})]})})]})}function z(a){return!!a&&/^\d{4}-\d{2}-\d{2}$/.test(a)}function A(a){if(!a)return null;let b=Number(a);return Number.isFinite(b)?b:null}}];

//# sourceMappingURL=app_%28admin%29_admin_supporters_page_tsx_fe0dd161._.js.map