exports.id=233,exports.ids=[233],exports.modules={7429:(a,b,c)=>{"use strict";function d(a){return a.replace(/[%_]/g,a=>`\\${a}`)}c.d(b,{w:()=>d})},15660:(a,b,c)=>{"use strict";c.r(b),c.d(b,{"403729602e36615f3cc269c414b9787b1a1906a3a3":()=>r,"40bc6b77175e259288e4035fd4cdda1c92b5ca0a43":()=>p,"40d070b60770c92a70f6fbcdb084a2988e925fc00c":()=>q});var d=c(91488);c(27806);var e=c(91837),f=c(69206),g=c(97077),h=c(27434),i=c(94914),j=c(67375),k=c(39493);let l=k.Ik({content:k.Yj().min(10,"기도 제목은 최소 10자 이상 작성해주세요."),imageUrl:k.Yj().url("올바른 이미지 주소가 아닙니다.").optional().or(k.eu("").transform(()=>void 0))}),m=l.extend({id:k.Yj().uuid()});var n=c(78375),o=c(89039);async function p(a){let b=await (0,g.BM)(["approved"]),c=l.safeParse(a);if(!c.success)return{status:"error",message:"입력값을 확인해주세요.",fieldErrors:c.error.flatten().fieldErrors};let d=await (0,i.d)(),f=(0,j.p)(c.data.content),{data:h,error:k}=await d.from("prayers").insert({author_id:b.id,content:f,image_url:c.data.imageUrl?c.data.imageUrl.trim():null}).select("id").single();if(k||!h)return(0,n.vV)("기도 작성 실패",{error:k,profileId:b.id}),{status:"error",message:"기도 제목을 등록하지 못했습니다. 잠시 후 다시 시도해주세요."};(0,e.revalidatePath)("/prayer")}async function q(a){let b=await (0,g.Rk)();if(!b)return{status:"error",message:"로그인 후 참여할 수 있습니다."};if("blocked"===b.status)return{status:"error",message:"차단된 계정은 반응을 남길 수 없습니다."};let c=await (0,i.d)(),{error:d}=await c.from("prayer_reactions").insert({prayer_id:a.prayerId,member_id:b.id,reaction_type:a.reaction});if(d)return"code"in d&&"23505"===d.code?{status:"success"}:((0,n.vV)("기도 반응 등록 실패",{error:d,profileId:b.id,payload:a}),{status:"error",message:"반응을 남기지 못했습니다. 잠시 후 다시 시도해주세요."});let f=new Set(["/prayer"]);return a.revalidate?.forEach(a=>f.add(a)),f.forEach(a=>(0,e.revalidatePath)(a)),{status:"success"}}async function r(a){let b=await (0,g.Rk)();b||(0,f.redirect)("/login?redirectTo=/prayer");let c=m.safeParse(a);if(!c.success)return{status:"error",message:"입력값을 확인해주세요.",fieldErrors:c.error.flatten().fieldErrors};let d=await (0,i.d)(),{data:k,error:l}=await d.from("prayers").select("author_id, image_url").eq("id",c.data.id).maybeSingle();if(l||!k)return(0,n.vV)("기도 조회 실패",{error:l,prayerId:c.data.id}),{status:"error",message:"기도 제목을 찾지 못했습니다."};if(k.author_id!==b.id&&!(0,h.qc)(b.role))return{status:"error",message:"수정 권한이 없습니다."};let p=c.data.imageUrl?c.data.imageUrl.trim():null,q=(0,j.p)(c.data.content),{error:r}=await d.from("prayers").update({content:q,image_url:p}).eq("id",c.data.id);if(r)return(0,n.vV)("기도 수정 실패",{error:r,prayerId:c.data.id}),{status:"error",message:"기도 제목을 수정하지 못했습니다. 잠시 후 다시 시도해주세요."};k.image_url&&k.image_url!==p&&await (0,o.RR)(d,k.image_url),(0,e.revalidatePath)("/prayer"),(0,e.revalidatePath)(`/prayer/${c.data.id}`),(0,f.redirect)(`/prayer/${c.data.id}`)}(0,c(40410).D)([p,q,r]),(0,d.A)(p,"40bc6b77175e259288e4035fd4cdda1c92b5ca0a43",null),(0,d.A)(q,"40d070b60770c92a70f6fbcdb084a2988e925fc00c",null),(0,d.A)(r,"403729602e36615f3cc269c414b9787b1a1906a3a3",null)},15740:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>h});var d=c(21124);c(38301);var e=c(16945),f=c(9212),g=c(19217);function h({error:a,reset:b}){return(0,d.jsxs)("div",{className:"mx-auto flex max-w-3xl flex-col items-center gap-4 rounded-2xl border border-destructive/40 bg-destructive/5 p-8 text-center",children:[(0,d.jsx)(e.A,{className:"h-10 w-10 text-destructive","aria-hidden":!0}),(0,d.jsxs)("div",{className:"space-y-1",children:[(0,d.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"기도 목록을 불러오는 중 문제가 발생했습니다."}),(0,d.jsxs)("p",{className:"text-sm text-muted-foreground",children:["잠시 후 다시 시도하거나, 계속된다면 관리자에게 알려주세요. 오류 코드: ",a.digest??"알 수 없음"]})]}),(0,d.jsxs)("div",{className:"flex flex-wrap items-center justify-center gap-3",children:[(0,d.jsxs)(g.$,{onClick:()=>b(),size:"sm",className:"gap-2",children:[(0,d.jsx)(f.A,{className:"h-4 w-4"}),"다시 시도"]}),(0,d.jsx)(g.$,{asChild:!0,variant:"outline",size:"sm",children:(0,d.jsx)("a",{href:"/support",children:"문의 페이지로 이동"})})]})]})}c(10016)},27434:(a,b,c)=>{"use strict";function d(a){return"approved"===a}function e(a){return"admin"===a}c.d(b,{SZ:()=>d,qc:()=>e})},42172:(a,b,c)=>{"use strict";function d(a,b){return a?a.length<=b?a:`${a.slice(0,b).trimEnd()}…`:""}function e(a){return a?a.replace(/[#*_>`~\[\]\(\)]/g,""):""}function f(a){return a?a.replace(/<[^>]*>/g,""):""}c.d(b,{EJ:()=>d,QZ:()=>f,eA:()=>e})},46743:(a,b,c)=>{"use strict";c.d(b,{N8:()=>i,kV:()=>k,yU:()=>j});var d=c(64445),e=c(48802),f=c(7429),g=c(42172),h=c(95354);async function i(a){let{page:b,pageSize:c,filters:e}=a,i=await (0,d.d)(),j=(b-1)*c,k=e?.search?.trim(),l=e?.status??"all",m=i.from("prayers").select(`
        id,
        content,
        created_at,
        is_answered,
        answered_at,
        author:profiles!prayers_author_id_fkey (
          id,
          full_name,
          status,
          role
        ),
        prayer_reactions (
          reaction_type
        ),
        image_url
      `,{count:"exact"}).order("created_at",{ascending:!1});if("answered"===l?m=m.eq("is_answered",!0):"pending"===l&&(m=m.eq("is_answered",!1)),k){let a=`%${(0,f.w)(k)}%`;m=m.or(`content.ilike.${a},profiles!prayers_author_id_fkey.full_name.ilike.${a}`)}let{data:n,count:o,error:p}=await m.range(j,j+c-1);if(p)return(0,h.vV)("기도 목록 조회 실패",{error:p,pagination:{page:b,pageSize:c},filters:e}),{items:[],total:0,page:b,pageSize:c};let q=n?.map(a=>{let b=a.content??"",c=(a.prayer_reactions??[]).reduce((a,b)=>(b?.reaction_type==="amen"&&(a.amen+=1),b?.reaction_type==="together"&&(a.together+=1),a),{amen:0,together:0});return{id:a.id,content:(0,g.EJ)((0,g.eA)(b),180),createdAt:a.created_at,isAnswered:a.is_answered,answeredAt:a.answered_at,authorName:a.author?.full_name??"익명",reactions:c,imageUrl:a.image_url??null}})??[];return{items:q,total:o??q.length,page:b,pageSize:c}}async function j(a){let b=await (0,d.d)(),{data:c,error:f}=await b.from("prayers").select(`
        id,
        content,
        created_at,
        is_answered,
        answered_at,
        author:profiles!prayers_author_id_fkey (
          id,
          full_name,
          status,
          role
        ),
        prayer_reactions (
          reaction_type
        ),
        image_url
      `).eq("id",a).maybeSingle();if(f)return(0,h.vV)("기도 상세 조회 실패",{error:f,prayerId:a}),null;if(!c)return null;let g=(c.prayer_reactions??[]).reduce((a,b)=>(b?.reaction_type==="amen"&&(a.amen+=1),b?.reaction_type==="together"&&(a.together+=1),a),{amen:0,together:0});return{id:c.id,content:(0,e.p)(c.content??""),createdAt:c.created_at,isAnswered:c.is_answered,answeredAt:c.answered_at,authorId:c.author?.id??"",authorName:c.author?.full_name??"익명",authorRole:c.author?.role??"member",authorStatus:c.author?.status??"approved",reactions:g,imageUrl:c.image_url??null}}async function k(){let a=await (0,d.d)(),[b,c]=await Promise.all([a.from("prayers").select("id",{count:"exact",head:!0}),a.from("prayers").select("id",{count:"exact",head:!0}).eq("is_answered",!0)]);b.error&&(0,h.vV)("전체 기도 수 조회 실패",{error:b.error}),c.error&&(0,h.vV)("응답 기도 수 조회 실패",{error:c.error});let e=b.count??0,f=c.count??0,g=Math.max(e-f,0);return{total:e,answered:f,pending:g}}},48802:(a,b,c)=>{"use strict";c.d(b,{p:()=>h});var d=c(11088),e=c.n(d);let f=["a","b","blockquote","br","code","em","i","img","li","ol","p","pre","strong","u","ul","h1","h2","h3","h4","h5","h6","span"],g=["href","target","rel","class","style","src","alt"];function h(a){return a?e().sanitize(a,{ALLOWED_TAGS:f,ALLOWED_ATTR:g,FORBID_TAGS:["script","iframe"]}):""}},70602:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>d});let d=(0,c(97954).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/antonio/Seize/Source/Wiruda/wmission/app/(public)/prayer/error.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/antonio/Seize/Source/Wiruda/wmission/app/(public)/prayer/error.tsx","default")},77041:(a,b,c)=>{Promise.resolve().then(c.bind(c,15740))},86769:(a,b,c)=>{Promise.resolve().then(c.bind(c,70602))},89039:(a,b,c)=>{"use strict";async function d(a,b,c={}){let e=function(a){if(!a)return null;try{let b=new URL(a).pathname.split("/").filter(Boolean),c=b.findIndex(a=>"public"===a);if(-1===c)return null;let d=decodeURIComponent(b[c+1]??""),e=b.slice(c+2).map(a=>decodeURIComponent(a)).join("/");if(!d||!e)return null;return{bucket:d,path:e}}catch(a){return console.error("공개 스토리지 URL 파싱 실패",a),null}}(b);if(!e)return;let f=c.expectedBucket??"content-images";if(f&&e.bucket!==f)return;let{error:g}=await a.storage.from(e.bucket).remove([e.path]);g&&console.error("스토리지 객체 삭제 실패",g)}c.d(b,{RR:()=>d})},95354:(a,b,c)=>{"use strict";function d(a,b){var c="error";let d=JSON.stringify({level:c,message:a,meta:function(a){if(a)return JSON.parse(JSON.stringify(a,(a,b)=>b instanceof Error?{name:b.name,message:b.message,stack:b.stack}:b))}(b),timestamp:new Date().toISOString(),environment:"production"});switch(c){case"error":console.error(d);break;case"warn":console.warn(d);break;default:console.info(d)}}c.d(b,{vV:()=>d})},97812:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>f});var d=c(75338),e=c(77774);function f(){return(0,d.jsxs)("div",{className:"space-y-8",children:[(0,d.jsxs)("header",{className:"space-y-2",children:[(0,d.jsx)(e.E,{className:"h-6 w-32"}),(0,d.jsx)(e.E,{className:"h-4 w-64"})]}),(0,d.jsx)(e.E,{className:"h-44 w-full rounded-2xl"}),(0,d.jsx)(e.E,{className:"h-px w-full"}),(0,d.jsx)("div",{className:"space-y-4",children:Array.from({length:4}).map((a,b)=>(0,d.jsxs)("article",{className:"space-y-4 rounded-2xl border border-border/60 p-4",children:[(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(e.E,{className:"h-4 w-24"}),(0,d.jsx)(e.E,{className:"h-5 w-3/5"}),(0,d.jsx)(e.E,{className:"h-4 w-40"})]}),(0,d.jsx)(e.E,{className:"h-10 w-full rounded-md"})]},b))}),(0,d.jsx)(e.E,{className:"h-12 w-full rounded-xl"})]})}}};